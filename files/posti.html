<!DOCTYPE html>
<html>
    <head>
        <title> Assegnazione Posti</title>
        <link href="style.css" rel="stylesheet" type="text/css">
        <script src="jquery.js"></script>
        <script>

            // quando il documento Ã¨ pronto, eseguo le funzioni importanti
            $(document).ready(function() {
                crea_sala();

                // aggiungo lo <span> a tutti i sedili non selezionati e, a questi <span>, la funzione per occupare o meno un posto
                setTimeout(function() {
                    $('#sala td.chair_empty').each(function() {
                        $(this).html('<span></span>');
                    });
                    setTimeout(function() {
                        $('#sala td span').bind("click", function() {
                            $(this).parent().toggleClass("selected");
                        });
                    }, 300);
                }, 300);
                toggle_acquista();
            });

            // funzione che crea la <table> che rappresenta la sala in base al contenuto del file txt corrispondente
            function crea_sala() {
                alfabeto = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];
                $.get("film/1/sala.txt", function(data) {
                    file = data.split("\n");
                    for(i=0;i<file.length-1;i++) {
                        $("#sala").append("<tr>");
                        fila = file[i];
                        for(j=0;j<fila.length;j++) {
                            switch(fila[j]) {
                                case "-":
                                    posto = '';
                                    break;
                                case "o":
                                    posto = ' class="chair_empty"';
                                    break;
                                case "x":
                                    posto = ' class="chair_full"';
                                    break;
                            }
                            $('#sala tr:nth-child('+(i+1)+')').append('<td id="'+alfabeto[i]+j+'" '+posto+'></td>');
                        }
                        $('#sala').append("</tr>");
                    }
                });
            }

            // funzione che controlla se abilitare o meno il tasto "acquista"
            function toggle_acquista() {
                setInterval(function() {
                    if($('#sala td.selected').length > 0) {
                        $('#conferma_prenotazione').addClass("visibile");
                    }else{
                        $('#conferma_prenotazione').removeClass("visibile");
                    }
                }, 10);
            }

        </script>
    </head>
    <body>
        <div class="popup" id="posti">
            <a href="informazioni.html" class="light close"></a>
            <iframe  src="https://www.youtube.com/embed/D7UpZmPmwSo?rel=0&amp;controls=0&amp;showinfo=0&amp;autoplay=1&amp;loop=1"></iframe>
            <table id="sala"></table>
        </div>
        <a href="riepologo.html" id="conferma_prenotazione">Conferma prenotazione</a>
    </body>
</html>
